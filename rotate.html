<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Atom - Forced Rotation</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>

<body>
  <script>
    // 1. ANIMATION COMPONENT (Keeps electrons moving)
    AFRAME.registerComponent('orbit-animation', {
      schema: { speed: {type: 'number', default: 1} },
      tick: function (time, timeDelta) {
        var rotation = this.el.getAttribute('rotation');
        this.el.setAttribute('rotation', {
          x: rotation.x,
          y: rotation.y + (this.data.speed * (timeDelta / 10)),
          z: rotation.z
        });
      }
    });

    // 2. ROTATION COMPONENT (The Fix)
    // This listens to the entire screen ("scene"), so you don't miss the atom.
    AFRAME.registerComponent('scene-rotation-handler', {
      init: function () {
        this.atom = document.querySelector('#atom-container');
        this.isDragging = false;
        this.startMouseX = 0;
        this.currentRotationY = 0;

        // Touch Start (Finger down)
        document.addEventListener('touchstart', (evt) => {
          this.isDragging = true;
          this.startMouseX = evt.touches[0].clientX;
          // Get current rotation or default to 0
          this.currentRotationY = this.atom.object3D.rotation.y;
        });

        // Touch Move (Dragging finger)
        document.addEventListener('touchmove', (evt) => {
          if (!this.isDragging) return;
          
          var currentMouseX = evt.touches[0].clientX;
          var distance = currentMouseX - this.startMouseX;
          
          // Sensitivity: Divide by 200 (Lower number = Faster spin)
          var rotationSpeed = distance / 100;

          // Apply rotation
          this.atom.object3D.rotation.y = this.currentRotationY + rotationSpeed;
        });

        // Touch End (Finger up)
        document.addEventListener('touchend', () => {
          this.isDragging = false;
        });
      }
    });
  </script>

  <!-- AR Scene -->
  <!-- We add the rotation handler to the SCENE so it works anywhere on screen -->
  <a-scene 
    vr-mode-ui="enabled: true" 
    renderer="antialias: true; alpha: true"
    scene-rotation-handler>
    
    <!-- LIGHTING -->
    <a-light type="directional" intensity="2" position="1 4 3"></a-light>
    <a-light type="ambient" intensity="1"></a-light>

    <!-- THE ATOM GROUP -->
    <!-- Positioned slightly lower and closer -->
    <a-entity id="atom-container" position="0 1.5 -2" scale="0.3 0.3 0.3">
      
        <!-- INVISIBLE HIT BOX (Visual Helper) -->
        <!-- This is a transparent box to help you visualize the center. 
             It is invisible (opacity="0") but ensures the object has 'volume' -->
        <a-box position="0 0 0" scale="4 4 4" material="opacity: 0; transparent: true"></a-box>

        <!-- NUCLEUS -->
        <a-entity animation="property: rotation; to: 360 360 0; loop: true; dur: 20000; easing: linear">
            <a-sphere position="0.2 0.2 0" radius="0.25" color="#FF3333"></a-sphere>
            <a-sphere position="-0.2 -0.2 0" radius="0.25" color="#FF3333"></a-sphere>
            <a-sphere position="0.2 -0.2 0.2" radius="0.25" color="#FF3333"></a-sphere>
            <a-sphere position="-0.2 0.2 0.1" radius="0.25" color="#3333FF"></a-sphere>
            <a-sphere position="0 0 -0.25" radius="0.25" color="#3333FF"></a-sphere>
            <a-sphere position="0.1 0.1 -0.1" radius="0.25" color="#3333FF"></a-sphere>
        </a-entity>

        <!-- ORBITS & ELECTRONS -->
        <a-entity rotation="0 0 45" orbit-animation="speed: 3">
             <a-torus color="#DDD" radius="1.5" radius-tubular="0.01" rotation="90 0 0" opacity="0.8"></a-torus>
             <a-sphere position="1.5 0 0" radius="0.15" color="#FFFF00" material="emissive: #FFFF00; emissiveIntensity: 1"></a-sphere>
        </a-entity>
        
        <a-entity rotation="0 180 -45" orbit-animation="speed: 3.5">
             <a-torus color="#DDD" radius="1.5" radius-tubular="0.01" rotation="90 0 0" opacity="0.8"></a-torus>
             <a-sphere position="1.5 0 0" radius="0.15" color="#FFFF00" material="emissive: #FFFF00; emissiveIntensity: 1"></a-sphere>
        </a-entity>

        <a-entity rotation="45 90 0" orbit-animation="speed: 2">
             <a-torus color="#DDD" radius="2.5" radius-tubular="0.01" rotation="90 0 0" opacity="0.8"></a-torus>
             <a-sphere position="2.5 0 0" radius="0.15" color="#FFFF00" material="emissive: #FFFF00; emissiveIntensity: 1"></a-sphere>
        </a-entity>

    </a-entity>

  </a-scene>
</body>
</html>

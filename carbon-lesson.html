<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Carbon: The Element of Life</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

  <style>
    body { margin: 0; background-color: #000; overflow: hidden; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; }

    /* --- 1. THE STUDY MATERIAL PAGES (White Background) --- */
    .study-page {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: #ffffff;
      color: #333;
      z-index: 20000; /* Highest priority */
      overflow-y: auto; /* Allow scrolling */
      padding: 30px 20px;
      box-sizing: border-box;
      transition: transform 0.5s ease-in-out;
    }

    .study-content {
      max-width: 600px;
      margin: 0 auto;
    }

    h1 { color: #2c3e50; font-size: 28px; margin-bottom: 10px; }
    h2 { color: #e67e22; font-size: 20px; margin-top: 20px; }
    p { line-height: 1.6; font-size: 16px; color: #555; }
    
    .highlight { background: #fff3cd; padding: 2px 5px; border-radius: 4px; }

    /* The Main CTA Button */
    .action-btn {
      display: block;
      width: 100%;
      background: linear-gradient(135deg, #00DDFF, #0055ff);
      color: white;
      border: none;
      padding: 18px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      margin-top: 30px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 85, 255, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .action-btn:active { transform: scale(0.98); }

    /* Hidden Class (To switch pages) */
    .hidden { display: none; }


    /* --- 2. THE AR HUD (Transparent Overlay) --- */
    #ar-hud {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 10000;
      display: none; /* Hidden by default */
      flex-direction: column;
      justify-content: space-between;
    }

    .hud-top {
      padding: 15px;
      text-align: center;
      background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
    }
    
    .exit-btn {
      background: rgba(255, 0, 0, 0.7);
      border: 1px solid white;
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 12px;
      pointer-events: auto;
      margin-top: 10px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      padding-bottom: 30px;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
      pointer-events: auto;
    }

    .round-btn {
      background: rgba(0, 20, 30, 0.9);
      border: 1px solid #00DDFF;
      color: #00DDFF;
      width: 50px; height: 50px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <!-- ========================================= -->
  <!-- PAGE 1: INTRODUCTION TEXT -->
  <!-- ========================================= -->
  <div id="page-intro" class="study-page">
    <div class="study-content">
      <h1>The Electronic Structure of Carbon</h1>
      <p>Carbon is the sixth element in the periodic table. It is often called the <span class="highlight">"Element of Life"</span> because it forms the backbone of all organic molecules.</p>
      
      <h2>Key Features:</h2>
      <ul>
        <li><strong>Atomic Number:</strong> 6</li>
        <li><strong>Protons:</strong> 6 (In the Nucleus)</li>
        <li><strong>Neutrons:</strong> 6 (In the Nucleus)</li>
      </ul>

      <h2>Why is it special?</h2>
      <p>The magic of Carbon lies in its electrons. It has <strong>6 electrons</strong> in total:</p>
      <ol>
        <li><strong>2 Inner Electrons</strong> (K-Shell)</li>
        <li><strong>4 Valence Electrons</strong> (L-Shell)</li>
      </ol>
      <p>These 4 valence electrons allow Carbon to form 4 strong covalent bonds with other atoms.</p>

      <button class="action-btn" onclick="startAR()">üé• Visualize 3D Model</button>
      <p style="text-align: center; font-size: 12px; color: #999; margin-top: 10px;">Click to view the interactive atom</p>
    </div>
  </div>


  <!-- ========================================= -->
  <!-- PAGE 2: SUMMARY TEXT (Hidden initially) -->
  <!-- ========================================= -->
  <div id="page-summary" class="study-page hidden">
    <div class="study-content">
      <h1>Observation Complete</h1>
      <p>You have just observed the 3D structure of Carbon.</p>
      
      <h2>What did we see?</h2>
      <p>In the model, the <span style="color: #FFD700; font-weight: bold;">Yellow Electrons</span> on the outer ring are the ones responsible for bonding. They are far away from the nucleus, making them ready to connect with other atoms.</p>

      <div style="background: #f0f8ff; padding: 15px; border-left: 5px solid #00DDFF; margin: 20px 0;">
        <strong>Quiz:</strong> How many electrons does Carbon have in its outer shell?<br>
        <em>Answer: 4</em>
      </div>

      <button class="action-btn" onclick="restartLesson()">üîÑ Restart Lesson</button>
      <button class="action-btn" style="background: #444; margin-top: 10px;" onclick="startAR()">üé• View Model Again</button>
    </div>
  </div>


  <!-- ========================================= -->
  <!-- AR HUD (Visible only during AR) -->
  <!-- ========================================= -->
  <div id="ar-hud">
    <div class="hud-top">
      <div style="color:#00DDFF; font-weight:bold; font-family:monospace; font-size:20px;">CARBON (C)</div>
      <button class="exit-btn" onclick="finishAR()">‚úÖ Finish Observation</button>
    </div>

    <div class="controls">
      <button class="round-btn" onclick="toggleExpand()">üí•</button>
      <button class="round-btn" onclick="toggleAnimation()">‚è∏</button>
      <button class="round-btn" id="audioBtn" onclick="toggleAudio()">üîä</button>
    </div>
  </div>

  <!-- AUDIO FILE -->
  <audio id="narrator" src="audio.mp3"></audio>


  <!-- ========================================= -->
  <!-- JAVASCRIPT LOGIC -->
  <!-- ========================================= -->
  <script>
    // --- PAGE SWITCHING LOGIC ---
    
    function startAR() {
      // Hide Text Pages
      document.getElementById('page-intro').classList.add('hidden');
      document.getElementById('page-summary').classList.add('hidden');
      
      // Show AR HUD
      document.getElementById('ar-hud').style.display = 'flex';
    }

    function finishAR() {
      // Hide AR HUD
      document.getElementById('ar-hud').style.display = 'none';
      
      // Show Summary Page
      document.getElementById('page-summary').classList.remove('hidden');
    }

    function restartLesson() {
      // Show Intro Page
      document.getElementById('page-intro').classList.remove('hidden');
      document.getElementById('page-summary').classList.add('hidden');
    }


    // --- 3D INTERACTION LOGIC ---
    
    // Physics Rotation
    AFRAME.registerComponent('momentum-rotation', {
      init: function () {
        this.el.sceneEl.addEventListener('touchstart', this.onTouchStart.bind(this));
        this.el.sceneEl.addEventListener('touchmove', this.onTouchMove.bind(this));
        this.el.sceneEl.addEventListener('touchend', this.onTouchEnd.bind(this));
        
        this.isDragging = false;
        this.previousMouse = {x: 0, y: 0};
        this.velocity = {x: 0, y: 0}; 
        this.friction = 0.95; 
      },
      onTouchStart: function(e) {
        this.isDragging = true;
        this.previousMouse.x = e.touches[0].clientX;
        this.previousMouse.y = e.touches[0].clientY;
        this.velocity = {x: 0, y: 0};
      },
      onTouchMove: function(e) {
        if (!this.isDragging) return;
        var dx = e.touches[0].clientX - this.previousMouse.x;
        var dy = e.touches[0].clientY - this.previousMouse.y;
        this.el.object3D.rotation.y += dx * 0.005;
        this.el.object3D.rotation.x += dy * 0.005;
        this.velocity.x = dx * 0.005;
        this.velocity.y = dy * 0.005;
        this.previousMouse.x = e.touches[0].clientX;
        this.previousMouse.y = e.touches[0].clientY;
      },
      onTouchEnd: function() { this.isDragging = false; },
      tick: function() {
        if (!this.isDragging) {
          this.el.object3D.rotation.y += this.velocity.x;
          this.el.object3D.rotation.x += this.velocity.y;
          this.velocity.x *= this.friction;
          this.velocity.y *= this.friction;
        }
      }
    });

    // Orbit Animation
    AFRAME.registerComponent('orbit-animation', {
      schema: { speed: {type: 'number', default: 1} },
      tick: function (time, timeDelta) {
        if (!this.el.getAttribute('is-paused')) {
           var rotation = this.el.getAttribute('rotation');
           this.el.setAttribute('rotation', {
             x: rotation.x,
             y: rotation.y + (this.data.speed * (timeDelta / 10)),
             z: rotation.z
           });
        }
      }
    });

    // Button Functions
    let isExpanded = false;
    function toggleExpand() {
      const kShell = document.querySelector('#k-shell');
      const lShell = document.querySelector('#l-shell');
      if (!isExpanded) {
        kShell.setAttribute('animation', 'property: scale; to: 1.8 1.8 1.8; dur: 800; easing: easeOutBack');
        lShell.setAttribute('animation', 'property: scale; to: 1.8 1.8 1.8; dur: 800; easing: easeOutBack');
      } else {
        kShell.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 800; easing: easeOutBack');
        lShell.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 800; easing: easeOutBack');
      }
      isExpanded = !isExpanded;
    }

    let isPaused = false;
    function toggleAnimation() {
      const orbits = document.querySelectorAll('[orbit-animation]');
      isPaused = !isPaused;
      orbits.forEach(el => {
        isPaused ? el.setAttribute('is-paused', 'true') : el.removeAttribute('is-paused');
      });
    }

    function toggleAudio() {
      var sound = document.getElementById("narrator");
      var btn = document.getElementById("audioBtn");
      if (sound.paused) {
        sound.play();
        btn.innerHTML = "‚¨õ";
        btn.style.color = "#FF0055";
        btn.style.borderColor = "#FF0055";
      } else {
        sound.pause();
        sound.currentTime = 0;
        btn.innerHTML = "üîä";
        btn.style.color = "#00DDFF";
        btn.style.borderColor = "#00DDFF";
      }
    }
  </script>

  <!-- ========================================= -->
  <!-- 3D SCENE (Always running in background) -->
  <!-- ========================================= -->
  <a-scene 
    vr-mode-ui="enabled: false"
    renderer="antialias: true; colorManagement: true; alpha: true"
    background="color: transparent">

    <a-light type="directional" intensity="3" position="-2 4 4" color="#aaccff"></a-light>
    <a-light type="point" intensity="2" position="0 0 0" color="#00DDFF" distance="5"></a-light>
    <a-light type="ambient" intensity="0.2"></a-light>

    <!-- The Atom Model -->
    <a-entity id="rotatable-container" position="0 1.5 -4" scale="0.4 0.4 0.4" momentum-rotation>
      <a-entity id="carbon-model">
        
        <!-- Nucleus -->
        <a-entity animation="property: rotation; to: 360 360 0; loop: true; dur: 20000; easing: linear">
          <a-mixin id="proton" geometry="primitive: sphere; radius: 0.3" material="color: #FF0055; metalness: 0.9; roughness: 0.1; emissive: #FF0055; emissiveIntensity: 0.3"></a-mixin>
          <a-mixin id="neutron" geometry="primitive: sphere; radius: 0.3" material="color: #00DDFF; metalness: 0.9; roughness: 0.1; emissive: #00DDFF; emissiveIntensity: 0.3"></a-mixin>
          
          <a-entity mixin="proton" position="0.2 0.2 0"></a-entity>
          <a-entity mixin="neutron" position="-0.2 -0.2 0"></a-entity>
          <a-entity mixin="proton" position="0.2 -0.2 0.25"></a-entity>
          <a-entity mixin="neutron" position="-0.2 0.2 0.1"></a-entity>
          <a-entity mixin="proton" position="0 0 -0.3"></a-entity>
          <a-entity mixin="neutron" position="0.1 0.1 -0.1"></a-entity>
          <a-entity mixin="proton" position="-0.3 0 0.1"></a-entity>
          <a-entity mixin="neutron" position="0.3 -0.1 0"></a-entity>
          <a-entity mixin="neutron" position="0 0.3 0.1"></a-entity>
          <a-entity mixin="proton" position="-0.1 0.2 -0.2"></a-entity>
          <a-entity mixin="proton" position="0.1 -0.3 0.2"></a-entity>
          <a-entity mixin="neutron" position="0.1 -0.2 0.2"></a-entity>
        </a-entity>

        <!-- K-Shell -->
        <a-entity id="k-shell">
           <a-torus radius="1.8" radius-tubular="0.01" rotation="90 0 0" color="#00DDFF" opacity="0.3"></a-torus>
           <a-entity rotation="0 0 20" orbit-animation="speed: 4">
              <a-sphere position="1.8 0 0" radius="0.15" color="white" material="emissive: #00DDFF; emissiveIntensity: 2"></a-sphere>
              <a-sphere position="-1.8 0 0" radius="0.15" color="white" material="emissive: #00DDFF; emissiveIntensity: 2"></a-sphere>
           </a-entity>
        </a-entity>

        <!-- L-Shell -->
        <a-entity id="l-shell">
           <a-torus radius="3.0" radius-tubular="0.01" rotation="90 0 0" color="#FFD700" opacity="0.3"></a-torus>
           <a-entity rotation="30 40 0" orbit-animation="speed: 2.5">
              <a-sphere position="3.0 0 0" radius="0.18" color="white" material="emissive: #FFD700; emissiveIntensity: 2"></a-sphere>
              <a-sphere position="-3.0 0 0" radius="0.18" color="white" material="emissive: #FFD700; emissiveIntensity: 2"></a-sphere>
           </a-entity>
           <a-entity rotation="-30 -40 0" orbit-animation="speed: 3">
              <a-sphere position="0 0 3.0" radius="0.18" color="white" material="emissive: #FFD700; emissiveIntensity: 2"></a-sphere>
              <a-sphere position="0 0 -3.0" radius="0.18" color="white" material="emissive: #FFD700; emissiveIntensity: 2"></a-sphere>
           </a-entity>
        </a-entity>

      </a-entity>
    </a-entity>
  </a-scene>

</body>
</html>
